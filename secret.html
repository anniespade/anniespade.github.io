<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lose You Now — Secret Room</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="pink-bg stars">
  <div class="noise"></div>

  <main class="secret-wrap">
    <header class="secret-head">
      <h1 class="neon small">WELCOME, <span id="fanName">Angel</span> ✨</h1>
      <p class="sub">You’re early. Here’s the first listen and a cute game game. Thank you for pre-saving! </p>
    </header>

    <section class="player-card">
      <div class="player-top">
        <img src="assets/cover.jpg" alt="Lose You Now cover art" />
        <div class="meta">
          <h2>Lose You Now</h2>
          <p>by Annie Spade</p>
          <button id="playBtn" class="enter-btn wide">▶︎ Play</button>
        </div>
      </div>
      <audio id="player" preload="metadata">
        <source src="audio/LoseYouNow.wav" type="audio/wav" />
        <!-- (add an mp3 too if you have it)
        <source src="audio/LoseYouNow.mp3" type="audio/mpeg" /> -->
        Your browser doesn’t support HTML5 audio.
      </audio>
      <div class="scrubber">
        <input id="seek" type="range" min="0" max="100" value="0" />
        <div class="time"><span id="cur">0:00</span> / <span id="dur">0:00</span></div>
      </div>
    </section>
   
<!-- Replace your <section class="game-card">...</section> with this -->
    <section class="game-card" id="petCard">
        <h3 class="y2k">Pixel Pet ★</h3>
    
        <!-- Status bars -->
        <div class="pet-bars">
        <div class="bar"><span>Hunger</span><div class="bar-fill" id="barHunger" style="width:80%"></div></div>
        <div class="bar"><span>Happy</span><div class="bar-fill" id="barHappy" style="width:90%"></div></div>
        <div class="bar"><span>Energy</span><div class="bar-fill" id="barEnergy" style="width:70%"></div></div>
        </div>
    
        <!-- The pet canvas -->
        <canvas id="pet" width="320" height="320" aria-label="Y2K Pixel Pet"></canvas>
    
        <!-- Controls -->
        <div class="pet-controls">
        <button class="enter-btn window-btn" id="btnFeed">Feed 🍓</button>
        <button class="enter-btn window-btn" id="btnPet">Pet ✨</button>
        <button class="enter-btn window-btn" id="btnSleep">Sleep 🌙</button>
        </div>
    
        <p class="hint">Tip: keep your pet fed, happy, and rested. Idle for a while and it gets sleepy 💤</p>
    </section>


    <footer class="ft">
      <a class="enter-btn ghost" href="./">Log out</a>
    </footer>
  </main>

  <script>
    // guard route — basic client-side check
    if (!sessionStorage.getItem('as_access_ok')) {
      location.replace('./');
    }
    const fanName = sessionStorage.getItem('as_fan_name') || 'Angel';
    document.getElementById('fanName').textContent = fanName;

    // simple audio UI
    const audio = document.getElementById('player');
    const playBtn = document.getElementById('playBtn');
    const seek = document.getElementById('seek');
    const cur = document.getElementById('cur');
    const dur = document.getElementById('dur');

    function fmt(s){const m=Math.floor(s/60)||0; const sec=Math.floor(s%60)||0; return `${m}:${sec.toString().padStart(2,'0')}`;}
    audio.addEventListener('loadedmetadata', ()=>{ dur.textContent = fmt(audio.duration||0); });
    audio.addEventListener('timeupdate', ()=>{ seek.value = ((audio.currentTime/audio.duration)*100)||0; cur.textContent = fmt(audio.currentTime); });
    seek.addEventListener('input', ()=>{ audio.currentTime = (seek.value/100)*(audio.duration||0); });
    playBtn.addEventListener('click', ()=>{
      if (audio.paused){ audio.play(); playBtn.textContent='⏸ Pause'; } else { audio.pause(); playBtn.textContent='▶︎ Play'; }
    });

   
  </script>

<script>
    /* ===== Pixel Tamagotchi Pet (no libraries) ===== */
    (function(){
      const cvs = document.getElementById('pet');
      const ctx = cvs.getContext('2d');
    
      // Bars
      const barH = document.getElementById('barHunger');
      const barHa = document.getElementById('barHappy');
      const barE = document.getElementById('barEnergy');
    
      // Controls
      const feedBtn = document.getElementById('btnFeed');
      const petBtn  = document.getElementById('btnPet');
      const sleepBtn= document.getElementById('btnSleep');
    
      // Pet state (0-100)
      const pet = {
        name: sessionStorage.getItem('as_fan_name') || 'Angel',
        hunger: 70, // fullness
        happy:  85,
        energy: 65,
        sleeping: false,
        t: 0,
        heartFx: [],
        sparkFx: []
      };
    
      // Helpers
      function clamp(v){ return Math.max(0, Math.min(100, v)); }
      function pctToColor(p){ // pastel -> green
        if(p > 66) return '#78d39b';
        if(p > 33) return '#f3c366';
        return '#e4819a';
      }
      function updateBars(){
        barH.style.width = pet.hunger + '%';
        barH.style.background = pctToColor(pet.hunger);
        barHa.style.width = pet.happy + '%';
        barHa.style.background = pctToColor(pet.happy);
        barE.style.width = pet.energy + '%';
        barE.style.background = pctToColor(pet.energy);
      }
    
      // Action handlers
      feedBtn.addEventListener('click', ()=>{
        pet.hunger = clamp(pet.hunger + 16);
        pet.happy  = clamp(pet.happy + 3);
        addHearts(5);
      });
      petBtn.addEventListener('click', ()=>{
        pet.happy  = clamp(pet.happy + 12);
        addSparkles(7);
      });
      sleepBtn.addEventListener('click', ()=>{
        pet.sleeping = !pet.sleeping;
        sleepBtn.textContent = pet.sleeping ? 'Wake ☀️' : 'Sleep 🌙';
      });
    
      // FX
      function addHearts(n){
        for(let i=0;i<n;i++){
          pet.heartFx.push({
            x: 160 + (Math.random()*40-20),
            y: 170 + (Math.random()*10-5),
            vy: - (0.8 + Math.random()*0.8),
            a: 1,
            s: 0.8 + Math.random()*0.6
          });
        }
      }
      function addSparkles(n){
        for(let i=0;i<n;i++){
          pet.sparkFx.push({
            x: 160 + (Math.random()*110-55),
            y: 170 + (Math.random()*70-35),
            vy: - (0.5 + Math.random()*0.6),
            a: 1,
            r: Math.random()*Math.PI*2
          });
        }
      }
    
      // Draw pet (simple pixel-y blob with ears, eyes, blush)
      function drawPet(){
        const t = pet.t;
        ctx.save();
        ctx.clearRect(0,0,cvs.width,cvs.height);
    
        // background panel
        ctx.fillStyle = '#f6e6dd';
        ctx.fillRect(0,0,320,320);
    
        // subtle gradient sky
        const g = ctx.createLinearGradient(0,0,0,320);
        g.addColorStop(0,'#fff5fb');
        g.addColorStop(1,'#f2dcff');
        ctx.fillStyle = g;
        ctx.fillRect(12,12,296,296);
    
        // table
        ctx.fillStyle = '#f0d8cf';
        ctx.fillRect(12,220,296,88);
    
        // body wobble
        const wob = Math.sin(t/18)*2;
    
        // shadow
        ctx.beginPath();
        ctx.ellipse(160, 230, 55, 12, 0, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(0,0,0,0.08)';
        ctx.fill();
    
        // body
        ctx.save();
        ctx.translate(0, wob);
        const bodyGrad = ctx.createLinearGradient(105,120,215,240);
        bodyGrad.addColorStop(0,'#ffffff');
        bodyGrad.addColorStop(1,'#f3e7ff');
        ctx.fillStyle = bodyGrad;
        roundedEgg(160,180,70,60,24);
        ctx.fill();
    
        // ears
        drawEar(125,120, -0.2);
        drawEar(195,120,  0.2);
    
        // face
        // eyes blink
        const blink = (Math.floor(t/120)%50===0) ? 0.15 : 1;
        ctx.fillStyle = '#5a4f61';
        // eyes
        ctx.beginPath(); ctx.ellipse(140,165,5,8*blink,0,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(180,165,5,8*blink,0,0,Math.PI*2); ctx.fill();
        // mouth (happy if happy>40, otherwise flat/sad)
        ctx.lineWidth = 2;
        ctx.strokeStyle = '#5a4f61';
        ctx.beginPath();
        if(pet.happy>40){
          ctx.arc(160,178,8,0,Math.PI,false);
        }else if(pet.happy>20){
          ctx.moveTo(150,178); ctx.lineTo(170,178);
        }else{
          ctx.arc(160,184,8,Math.PI,0,false);
        }
        ctx.stroke();
    
        // blush
        ctx.globalAlpha = 0.5;
        ctx.fillStyle = '#ffb3c6';
        ctx.beginPath(); ctx.ellipse(128,178,9,5,0,0,Math.PI*2); ctx.fill();
        ctx.beginPath(); ctx.ellipse(192,178,9,5,0,0,Math.PI*2); ctx.fill();
        ctx.globalAlpha = 1;
    
        ctx.restore();
    
        // Zzz overlay if sleeping
        if(pet.sleeping){
          ctx.fillStyle = 'rgba(131,104,203,0.08)';
          ctx.fillRect(12,12,296,296);
          ctx.font = '20px Arial';
          ctx.fillStyle = '#a788ff';
          ctx.fillText('Z', 220, 80 + Math.sin(t/8)*3);
          ctx.fillText('z', 235, 95 + Math.cos(t/10)*3);
          ctx.fillText('Z', 250, 70 + Math.sin(t/12)*3);
        }
    
        // Hearts FX
        pet.heartFx.forEach(h=>{
          ctx.save();
          ctx.translate(h.x, h.y);
          ctx.scale(h.s, h.s);
          ctx.globalAlpha = h.a;
          ctx.fillStyle = 'rgba(255,120,180,0.95)';
          ctx.beginPath();
          ctx.moveTo(0,0);
          ctx.bezierCurveTo(-8,-8,-14,6,0,14);
          ctx.bezierCurveTo(14,6,8,-8,0,0);
          ctx.fill();
          ctx.restore();
        });
    
        // Sparkles FX
        pet.sparkFx.forEach(s=>{
          ctx.save();
          ctx.translate(s.x, s.y);
          ctx.rotate(s.r + t/50);
          ctx.globalAlpha = s.a;
          ctx.fillStyle = '#ffffff';
          star(0,0,5,8,4);
          ctx.fill();
          ctx.restore();
        });
    
        ctx.restore();
      }
    
      function drawEar(x,y,tilt){
        ctx.save();
        ctx.translate(x,y);
        ctx.rotate(tilt);
        ctx.fillStyle = '#ffffff';
        roundedEgg(0,0,18,26,8);
        ctx.fill();
        ctx.fillStyle = '#ffd6f0';
        roundedEgg(0,4,10,16,6);
        ctx.fill();
        ctx.restore();
      }
    
      // Shapes
      function roundedEgg(cx,cy,rx,ry,r){
        ctx.beginPath();
        ctx.moveTo(cx-rx+r, cy-ry);
        ctx.arcTo(cx+rx, cy-ry, cx+rx, cy+ry, r);
        ctx.arcTo(cx+rx, cy+ry, cx-rx, cy+ry, r);
        ctx.arcTo(cx-rx, cy+ry, cx-rx, cy-ry, r);
        ctx.arcTo(cx-rx, cy-ry, cx+rx, cy-ry, r);
        ctx.closePath();
      }
      function star(x,y, spikes, outerR, innerR){
        let rot = Math.PI/2 * 3;
        let cx = x, cy = y;
        let step = Math.PI / spikes;
        ctx.beginPath();
        ctx.moveTo(cx, cy - outerR);
        for (let i=0; i<spikes; i++) {
          let x1 = cx + Math.cos(rot) * outerR;
          let y1 = cy + Math.sin(rot) * outerR;
          ctx.lineTo(x1, y1);
          rot += step;
    
          x1 = cx + Math.cos(rot) * innerR;
          y1 = cy + Math.sin(rot) * innerR;
          ctx.lineTo(x1, y1);
          rot += step;
        }
        ctx.closePath();
      }
    
      // Game loop & needs
      function tick(){
        pet.t++;
    
        // Natural needs decay/regeneration
        if(pet.sleeping){
          pet.energy = clamp(pet.energy + 0.2);
          pet.happy  = clamp(pet.happy - 0.02);
          // hunger still drops slowly while sleeping
          pet.hunger = clamp(pet.hunger - 0.02);
          if(pet.energy >= 100){ pet.sleeping = false; sleepBtn.textContent = 'Sleep 🌙'; }
        }else{
          pet.hunger = clamp(pet.hunger - 0.04);
          pet.energy = clamp(pet.energy - 0.03);
          // happiness drifts towards the average of other stats
          const target = (pet.hunger + pet.energy)/2;
          pet.happy += (target - pet.happy) * 0.004;
          pet.happy = clamp(pet.happy);
        }
    
        // FX motion
        pet.heartFx.forEach(h=>{ h.y += h.vy; h.a -= 0.02; });
        pet.heartFx = pet.heartFx.filter(h=> h.a > 0);
        pet.sparkFx.forEach(s=>{ s.y += s.vy; s.a -= 0.025; });
        pet.sparkFx = pet.sparkFx.filter(s=> s.a > 0);
    
        updateBars();
        drawPet();
        requestAnimationFrame(tick);
      }
    
      // Initial draw
      updateBars();
      drawPet();
      tick();
    })();
    </script>
    

</body>
</html>
