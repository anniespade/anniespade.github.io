<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lose You Now — Secret Room</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="pink-bg stars">
  <div class="noise"></div>

  <main class="secret-wrap">
    <header class="secret-head">
      <h1 class="neon small">WELCOME, <span id="fanName">Angel</span> ✨</h1>
      <p class="sub">You’re early. Here’s the first listen and a tiny Y2K mini-game while you vibe.</p>
    </header>

    <section class="player-card">
      <div class="player-top">
        <img src="assets/cover.jpg" alt="Lose You Now cover art" />
        <div class="meta">
          <h2>Lose You Now</h2>
          <p>by Annie Spade</p>
          <button id="playBtn" class="enter-btn wide">▶︎ Play</button>
        </div>
      </div>
      <audio id="player" preload="metadata">
        <source src="audio/LoseYouNow.wav" type="audio/wav" />
        <!-- (add an mp3 too if you have it)
        <source src="audio/LoseYouNow.mp3" type="audio/mpeg" /> -->
        Your browser doesn’t support HTML5 audio.
      </audio>
      <div class="scrubber">
        <input id="seek" type="range" min="0" max="100" value="0" />
        <div class="time"><span id="cur">0:00</span> / <span id="dur">0:00</span></div>
      </div>
    </section>

    <section class="game-card">
      <h3 class="y2k">Heart Catcher ♥</h3>
      <canvas id="game" width="320" height="480" aria-label="Heart Catcher mini game"></canvas>
      <div class="score">Score: <span id="score">0</span></div>
      <p class="hint">Catch 20 hearts to unlock a sparkle overlay ✨</p>
    </section>

    <footer class="ft">
      <a class="enter-btn ghost" href="./">Log out</a>
    </footer>
  </main>

  <script>
    // guard route — basic client-side check
    if (!sessionStorage.getItem('as_access_ok')) {
      location.replace('./');
    }
    const fanName = sessionStorage.getItem('as_fan_name') || 'Angel';
    document.getElementById('fanName').textContent = fanName;

    // simple audio UI
    const audio = document.getElementById('player');
    const playBtn = document.getElementById('playBtn');
    const seek = document.getElementById('seek');
    const cur = document.getElementById('cur');
    const dur = document.getElementById('dur');

    function fmt(s){const m=Math.floor(s/60)||0; const sec=Math.floor(s%60)||0; return `${m}:${sec.toString().padStart(2,'0')}`;}
    audio.addEventListener('loadedmetadata', ()=>{ dur.textContent = fmt(audio.duration||0); });
    audio.addEventListener('timeupdate', ()=>{ seek.value = ((audio.currentTime/audio.duration)*100)||0; cur.textContent = fmt(audio.currentTime); });
    seek.addEventListener('input', ()=>{ audio.currentTime = (seek.value/100)*(audio.duration||0); });
    playBtn.addEventListener('click', ()=>{
      if (audio.paused){ audio.play(); playBtn.textContent='⏸ Pause'; } else { audio.pause(); playBtn.textContent='▶︎ Play'; }
    });

    // tiny Y2K heart-clicker
    const c=document.getElementById('game'),x=c.getContext('2d');
    const hearts=[]; let score=0; const scoreEl=document.getElementById('score');
    function newHeart(){
      hearts.push({x:Math.random()*280+20, y:480+20, s:0.6+Math.random()*0.8, vy:1.2+Math.random()*1.8});
    }
    for(let i=0;i<8;i++) newHeart();
    function drawHeart(h){
      const s=h.s*10; x.save(); x.translate(h.x,h.y); x.scale(s,s);
      x.beginPath(); x.moveTo(0,0);
      x.bezierCurveTo(-12,-12,-22,8,0,20);
      x.bezierCurveTo(22,8,12,-12,0,0);
      x.closePath(); x.fillStyle='rgba(255,255,255,0.9)'; x.shadowColor='#ffb7e8'; x.shadowBlur=20; x.fill(); x.restore();
    }
    c.addEventListener('click', (e)=>{
      const r=c.getBoundingClientRect(); const mx=e.clientX-r.left; const my=e.clientY-r.top;
      hearts.forEach((h,i)=>{
        const dx=mx-h.x, dy=my-h.y; if(Math.hypot(dx,dy)<18){ score++; scoreEl.textContent=score; hearts.splice(i,1); newHeart(); }
      });
      if(score>=20){ document.body.classList.add('sparkle'); }
    });
    function loop(){
      x.clearRect(0,0,c.width,c.height);
      hearts.forEach(h=>{ h.y-=h.vy; if(h.y<-20){ h.y=500; h.x=Math.random()*280+20; } drawHeart(h); });
      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
